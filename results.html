<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Class Test Result</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:"Segoe UI",Arial;
  background:#f4f6f8;
  margin:0;
}
.header{
  background:#203a43;
  color:#fff;
  padding:14px;
  text-align:center;
  font-weight:700;
}
.score{
  text-align:center;
  font-size:20px;
  font-weight:800;
  margin:16px 0;
}
.card{
  background:#fff;
  margin:12px;
  padding:14px;
  border-radius:14px;
  box-shadow:0 8px 18px rgba(0,0,0,.15);
}
.option{
  padding:8px;
  margin-top:6px;
  border-radius:8px;
}
.correct{background:#e8f5e9;color:#1b5e20;}
.wrong{background:#fdecea;color:#b71c1c;}
.neutral{background:#f5f7fa;}
</style>
</head>

<body>

<div class="header">Class Test Result</div>
<div class="score" id="score"></div>
<div id="content"></div>

<script>
const BACKEND = "https://script.google.com/macros/s/AKfycbwp77JjKdBcjRnK1FKp8Pv1Dbbw7zu29Q9KQbJ7ZSJx9BgogIi2By_IVnYgwEEgiKXE/exec";
const token = sessionStorage.getItem("token");
if(!token) location.replace("index.html");

const testId = new URLSearchParams(location.search).get("test");

fetch(BACKEND,{
  method:"POST",
  body:new URLSearchParams({
    action:"getDetailedResult",
    token,
    testId
  })
})
.then(r=>r.json())
.then(res=>{
  if(res.status !== "OK"){
    alert("Result not available");
    return;
  }

  document.getElementById("score").innerText =
    `Score: ${res.score}`;

  document.getElementById("content").innerHTML =
    res.questions.map((q,i)=>`
      <div class="card">
        <b>Q${i+1}. ${q.question}</b><br><br>
        ${["A","B","C","D"].map(o=>{
          let cls="neutral";
          if(o===q.correct) cls="correct";
          else if(o===q.selected && o!==q.correct) cls="wrong";
          return `<div class="option ${cls}">
            ${o}. ${q.options[o]}
          </div>`;
        }).join("")}
      </div>
    `).join("");
});
</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Class Test Result</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  .initial-loading{
  text-align:center;
  font-weight:700;
  padding:20px;
  color:#1565c0;
}
body{
  font-family:"Segoe UI",Arial;
  background:#f4f6f8;
  margin:0;
}
.header{
  background:#203a43;
  color:#fff;
  padding:14px;
  text-align:center;
  font-weight:700;
}
.score{
  text-align:center;
  font-size:20px;
  font-weight:800;
  margin:16px 0;
}
.card{
  background:#fff;
  margin:12px;
  padding:14px;
  border-radius:14px;
  box-shadow:0 8px 18px rgba(0,0,0,.15);
}
  .option.correct{
  background:#e8f5e9;
  color:#1b5e20;
  font-weight:800;
  border:2px solid #2e7d32;
}

.option.wrong{
  background:#fdecea;
  color:#b71c1c;
  border:2px solid #c62828;
}.option::before{
  content:"○";
  font-weight:800;
  margin-right:8px;
}
.option.correct::before,
.option.wrong::before{
  content:"●";
}
.option{
  padding:8px;
  margin-top:6px;
  border-radius:8px;
}
  .closeBtn{
  position:fixed;
  bottom:14px;
  left:50%;
  transform:translateX(-50%);
  background:#203a43;
  color:#fff;
  border:none;
  padding:14px 28px;
  border-radius:30px;
  font-size:15px;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 8px 18px rgba(0,0,0,.25);
}

.closeBtn:hover{
  background:#162a32;
}
.neutral{background:#f5f7fa;}
</style>
</head>

<body>
<div class="header">Class Test Result</div>
  <div id="initialLoader" class="initial-loading">
  Loading answer sheet… Please wait
</div>
<div class="score" id="score"></div>
<div id="content"></div>
<script src="config.js"></script>
<script>
const BACKEND = BACKEND_URL;
const token = sessionStorage.getItem("token");
if(!token) location.replace("index.html");

const testId = new URLSearchParams(location.search).get("test");

fetch(BACKEND,{
  method:"POST",
  body:new URLSearchParams({
    action:"getDetailedResult",
    token,
    testId
  })
})
.then(r=>r.json())
.then(res=>{
   document.getElementById("initialLoader").style.display = "none";
  if(res.status !== "OK"){
    alert("Result not available");
    return;
  }

  document.getElementById("score").innerText =
    `Score: ${res.score} / ${res.questions.length}`;

  document.getElementById("content").innerHTML =
    res.questions.map((q,i)=>`
      <div class="card">
        <b>Q${i+1}. ${q.question}</b><br><br>
        ${["A","B","C","D"].map(o=>{
          let cls="neutral";
          if(o===q.correct) cls="correct";
          else if(o===q.selected && o!==q.correct) cls="wrong";
          return `<div class="option ${cls}">
            ${o}. ${q.options[o]}
          </div>`;
        }).join("")}
      </div>
    `).join("");
});
    function goBack(){
  if(confirm("Go back to dashboard?")){
    location.href = "SDB.html";
  }
}
</script>
<button class="closeBtn" onclick="goBack()">
  Close & Go to Dashboard
</button>
</body>
</html>
